clear all
%-----------Compare rev5 with data in test1_PFTlab_freeze-----------
% <0.7 L sucked in (inhaled by syringe)>
% not sure if good data
%       readVal = [509,514,515,514,515,514,515,514,504,513,515,515,515,516,515,516,515,515,514,515,513,516,514,516,514,515,513,516,513,513,512,513,511,514,514,514,516,514,514,513,513,513,513,514,513,504,513,514,515,514,515,515,515,514,515,514,515,514,515,514,515,513,515,513,518,513,513,512,513,513,513,514,512,515,513,512,512,512,511,511,512,511,510,509,512,512,512,512,512,512,512,513,513,513,512,514,513,514,513,542,502,504,511,510,508,509,510,509,511,509,510,509,509,509,509,509,508,509,509,509,508,509,510,509,510,509,510,509,510,509,511,509,510,509,511,509,514,509,509,509,509,507,509,510,509,510,509,510,509,509,509,509,509,508,508,508,510,509,508,509,509,510,509,510,509,511,510,510,509,510,509,511,508,510,509,509,509,509,508,509,510,509,510,509,509,509,509,509,509,510,508,509,508,510,509,510,510,509,510,509,510,509,510,509,510,509,510,507,510,509,512,509,509,508,509,509,509,510,509,510,509,509,510,509,509,509,509,508,509,507,511,510,509,510,509,510,509,510,509,510,509,510,509,510,509,513,509,510,509,510,508,509,510,509,510,509,511,509,510,509,510,509,508,510,507,508,509,511,510,509,510,509,510,509,510,509,511,509,511,509,512,509,511,509,509,509,509,508,509,510,509,510,509,510,508,510,509,510,509,509,508,509,509,509,511,510,509,510,509,510,509,510,509,510,509,510,509,510,509,511,508,509,508,509,510,509,510,509,512,509,509,509,508,508,509,508,508,508,507,509,509,511,509,509,510,510,510,509,510,509,511,509,510,509,512,509,512,509,509,509,509,511,509,510,509,510,509,509,510,509,509,509,508,507,509,509,509,510,510,510,509,510,509,510,509,511,513,511,509,511,509,511,509,509,508,509,507,509,511,509,511,509,509,509,509,510,509,509,508,508,508,509,509,509,510,512,510,509,510,509,510,509,511,509,510,509,510,509,510,509,509,508,509,510,509,510,509,512,509,509,509,509,509,509,509,508,508,507,509,510,509,510,510,510,510,510,509,510,509,511,509,510,509,510,509,512,509,509,509,509,510,509,511,509,510,509,509,509,509,509,509,508,508,509,509,509,510,509,510,512,510,509,510,509,510,509,510,508,510,507,510,509,509,509,509,511,509,510,509,511,509,510,509,509,509,509,509,508,509,507,509,510,509,510,509,510,513,510,509,510,509,510,509,509,508,510,509,509,509,509,509,509,508,509,510,509,509,508,508,508,509,508,508,509,508,508,507,509,509,509,509,509,510,512,510,509,510,509,510,509,510,509,513,508,511,508,509,509,509,509,509,509,509,510,508,509,508,508,509,508,508,508,509,508,509,509,509,510,509,510,513,510,509,510,509,510,509,511,509,510,509,510,508,509,508,509,510,509,510,506,510,509,510,509,509,508,509,510,508,509,509,510,510,510,510,509,510,514,510,509,511,509,510,509,512,509,511,509,509,510,509,508,509,510,509,510,509,509,509,509,509,509,510,508,509,509,509,509,509,510,509,510,509,510,514,510,509,511,509,511,509,511,509,512,509,509,509,509,509,509,509,509,511,509,509,509,509,509,508,509,508,508,507,509,510,509,510,509,510,509,510,512,510,509,511,509,511,509,512,509,511,509,509,509,509,510,509,510,509,511,509,509,509,509,509,509,508,508];

%<3 liters injected (fast pace)>
% W/ Revised got 2.7623 (simpson's=2.7597 & ebel's=2.7881 when L=737).(orig = 2.92756)
%       readVal = [509,519,520,527,527,534,533,536,533,533,530,531,527,528,529,529,534,534,538,540,542,545,546,549,551,543,555,559,561,562,562,564,566,567,569,569,571,570,571,569,571,570,571,570,575,571,571,570,571,571,572,573,571,573,572,572,570,572,570,572,566,565,565,563,566,564,566,564,564,563,560,560,559,559,556,558,555,556,553,557,549,552,548,547,544,543,542,541,541,539,539,537,537,534,534,533,532,531,531,530,566,452,530,507,514,511,510,510,509,509,510,510,510,509,511,509,512,508,509,508,509,508,509,510,509,510,509,510,509,509,509,509,510,509,499,508,509,510,509,510,509,510,509,510,509,510,509,510,508,511,510,511,509,511,509,509,509,509,507,510,510,509,510,509,509,509,509,509,509,502,509,509,509,510,510,510,510,509,510,509,510,509,510,509,511,509,510,509,510,509,510,509,509,509,509,510,509,510,509,511,509,509,509,509,508,509,509,508,508,509,510,509,510,510,509,510,509,510,509,510,509,511,509,510,509,510,509,510,508,509,508,509,510,509,510,509,511,509,509,509,508,505,508,508,510,508,508,509,509,510,510,509,510,509,510,509,510,508,510,509,510,509,511,509,512,508,509,508,509,510,509,510,509,509,509,509,509,509,509,508,509,507,509,507,509,509,509,510,512,510,509,510,509,510,509,511,509,510,509,511,509,510,509,509,509,509,510,509,510,509,511,509,509,510,509,510,509,508,508,510,508,510,510,511,510,509,510,509,510,509,510,509,511,507,510,508,510,509,509,508,509,507,509,510,509,511,509,509,509,509,509,508,509,508,508,508,509,510,509,509,509,510,512,510,508,510,508,510,508,510,509,509,509,514,509,509,509,509,509,509,510,509,510,509,509,509,509,507,509,508,507,509,507,509,509,509,510,509,510,509,510,510,510,509,510,508,510,506,510,509,511,509,509,508,509,510,509,511,509,511,509,509,509,509,508,508,508,508,508,507,510,509,510,510,509,510,513,510,509,510,509,510,509,510,509,510,509,512,509,509,508,509,510,509,511,509,512,509,510,509,510,509,508,508,508,508,507,509,509,509,510,509,510,513,510,509,510,509,510,509,511,509,512,509,512,509,508,509,509,509,509,511,509,510,509,509,509,509,509,509,508,508,509,509,510,510,509,510,509,510,509,510,509,510,509,510,509,511,509,514,509,509,508,509,507,509,510,509,510,509,510,509,509,509,509,503,508,508,509,509,509,510,510,509,510,509,510,509,510,509,510,509,510,509,510,509,512,510,509,509,509,508,509,510,509,510,509,509,509,509,509,509,508,508,503,508,509,509,509,510,509,510,509,510,509,510,509,510,509,510,509,511,509,512,508,509,508,509,510,509,510,509,510,509,510,509,509,509,509,508,508,508,507,509,509,509,510,509,510,509,510,513,510,509,511,509,511,509,512,509,511,509,509,508,509,511,509,510,509,509,509,509,509,509,508,509,508,508,509,507,509,509,510,510,509,510,509,510,509,510,509,510,509,510,509,511,509,511,509,509,508,508,510,509,510,509,510,509,509,509,509,509,508,509,508,509,508,509,510,509,510,509,510,513,510,509,510,509,510,509,510,507,511,509,510,509,509,508,509,510,509,510,509,511,509,509,509,509,509,509,509,508,509,509,510,510,509,510,509,510,510,510,509,511,509,511,509];%,512];

%<3 liters injected (fast pace)>
% W/ revised got 2.8453 (simpson's=2.8453 & ebel's=2.8357 when L=737). (orig = 2.91786)
%       readVal = [509,514,516,519,522,523,526,526,529,529,532,530,532,530,534,533,537,538,541,543,545,546,547,548,549,552,553,556,558,560,561,562,564,566,556,567,567,569,570,570,572,572,571,573,571,572,569,572,568,571,568,571,568,573,569,570,567,569,568,567,567,565,567,564,563,563,562,561,559,559,558,560,555,557,557,557,556,556,555,554,554,550,550,547,549,543,546,539,542,538,540,535,534,533,532,531,525,528,526,527,525,524,522,522,525,481,525,510,506,510,508,508,509,510,509,510,509,510,510,511,509,511,509,510,509,511,509,512,509,509,508,509,509,509,511,509,512,509,509,510,510,509,511,509,510,509,506,510,509,509,510,509,510,510,510,512,510,510,511,509,510,510,513,509,512,509,509,509,509,510,509,511,509,510,509,509,509,509,510,509,509,508,508,506,508,509,510,510,509,510,509,509,509,510,509,510,509,510,509,511,509,511,508,509,508,509,510,509,510,508,509,509,509,509,509,509,508,508,507,508,506,508,509,509,509,509,510,509,510,509,510,509,510,509,509,509,510,509,511,509,509,508,509,510,510,510,509,510,509,509,509,509,509,509,508,509,509,507,509,510,509,510,509,510,509,510,509,510,509,510,508,510,506,512,509,511,508,509,511,509,510,509,510,509,511,509,509,510,509,509,509,508,507,510,508,509,510,509,510,509,510,509,510,509,511,509,511,509,510,509,512,509,509,508,509,507,509,510,509,511,509,510,509,509,508,509,509,508,508,508,509,509,509,510,509,510,509,510,509,510,512,510,509,510,509,511,509,510,509,509,509,509,508,509,510,509,509,509,510,509,509,509,509,508,509,508,508,511,508,510,510,509,510,509,510,509,510,509,511,509,510,509,510,509,511,509,508,508,509,509,509,510,509,509,509,509,509,509,509,508,508,509,508,507,510,508,509,509,509,509,509,510,509,510,509,511,509,510,509,510,509,511,509,509,509,509,508,509,509,509,509,509,509,509,509,509,509,509,508,509,509,510,509,510,510,509,510,509,510,509,510,509,511,509,510,509,510,509,510,509,509,508,509,510,509,510,509,510,509,509,509,509,508,508,509,508,508,507,510,510,509,510,509,510,509,510,509,510,509,510,509,510,509,512,509,511,509,509,508,509,510,509,511,510,510,509,510,510,509,510,509,509,509,509,508,509,510,509,510,509,510,509,510,509,510,509,510,509,510,509,511,509,511,509,509,509,509,511,509,510,509,510,509,509,509,509,508,509,509,507,509,509,511,510,509,510,510,510,509,510,509,511,509,511,508,511,509,511,509,509,509,509,508,509,511,509,510,510,509,509,509,509,509,509,508,508,508,509,510,510,509,509,509,509,510,509,510,509,510,509,510,509,511,509,510,509,509,508,509,507,509,510,509,511,509,509,509,509,509,508,508,508,507,508,509,508,511,510,509,510,509,510,509,510,509,510,509,510,509,511,509,512,509,509,508,509,507,509,510,509,510,509,510,509,510,509,508,508,508,508,507,509,510,509,510,510,510,509,510,509,510,512,510,509,510,509,510,509,512,509,509,509,509,509,510,510,509,510,509,509,509,509,509,509,509,509,510,509,510,509,511,510,510,510,509,510,509,511,509,510,509,509,508,511,509,511,509,509,508,509,510,509,509,509,511,508,508,509,509,509,508,502,507,507,507,509,509,510];

%<3 L inward (slower pace)>
% W/ revised got 2.5502 (simpson's=2.5562 & ebel's=2.5483 when L=737). (original = 2.12218)
%      readVal = [509,515,515,515,517,515,517,518,518,520,519,520,524,521,520,522,520,522,520,521,520,521,519,523,519,520,519,519,518,519,520,518,519,518,517,514,518,517,516,516,515,516,515,516,516,517,517,516,517,516,517,516,518,517,518,516,518,516,518,516,521,516,517,515,516,517,516,518,516,518,516,516,515,515,515,515,506,514,515,515,515,513,515,515,515,515,514,514,514,515,514,515,514,515,514,517,514,516,514,514,513,514,516,515,515,514,515,514,514,515,514,514,514,514,514,513,512,515,516,515,516,515,516,515,516,515,517,515,517,515,516,511,518,515,515,514,514,514,514,515,513,515,513,514,512,513,513,512,513,512,502,512,513,513,513,513,513,513,513,514,513,514,513,514,513,514,513,515,513,518,513,513,513,513,514,514,515,511,515,514,514,514,513,513,512,513,512,513,510,512,512,512,512,512,513,512,513,512,512,511,512,511,513,511,512,510,512,510,511,510,511,509,511,512,511,512,511,511,511,511,511,510,512,511,502,510,511,512,511,511,511,512,511,512,511,512,511,512,511,512,511,512,510,514,511,511,510,511,510,511,512,511,512,511,511,511,510,510,510,503,510,511,511,511,510,511,511,511,511,511,511,511,511,510,512,510,511,510,511,510,513,509,511,509,510,511,510,511,510,511,511,511,511,510,510,509,511,509,509,508,511,511,511,511,511,512,511,512,502,514,506,512,510,509,509,512,509,511,509,509,508,509,510,509,510,509,510,509,509,509,508,509,508,508,508,508,508,509,509,509,509,510,509,510,510,509,510,509,510,509,511,509,512,509,512,508,509,509,509,510,509,510,509,511,509,509,509,509,510,508,508,508,510,510,507,509,510,509,509,510,509,510,509,510,509,510,509,511,509,514,509,509,508,509,507,509,510,509,510,509,510,509,509,509,509,509,508,508,508,510,509,509,510,509,510,509,510,510,510,509,510,509,511,509,512,509,513,509,509,509,509,508,509,509,509,509,509,509,509,509,509,509,508,508,508,509,510,509,509,509,509,510,509,510,509,510,509,510,509,510,509,510,509,513,509,509,509,509,509,509,510,509,511,509,509,509,509,508,509,508,508,508,508,510,509,510,510,509,510,510,510,509,510,508,511,508,510,509,511,509,511,509,509,508,509,510,509,510,510,512,509,509,509,509,509,508,509,508,508,507,509,510,511,510,509,510,509,510,509,510,508,510,508,510,506,510,509,513,509,509,509,509,510,509,511,509,510,509,509,509,509,509,509,509,508,508,508,511,510,509,510,509,510,509,510,509,510,509,510,509,510,509,511,509,510,508,509,508,509,510,509,510,509,510,508,509,509,508,509,508,509,507,509,509,509,509,510,509,511,509,509,510,509,510,509,510,509,510,508,511,508,509,508,509,507,509,510,509,510,509,509,509,509,508,508,509,508,507,507,509,509,511,510,509,509,509,510,510,510,509,511,508,511,509,511,509,511,509,509,509,509,508,509,510,509,510,509,509,509,509,509,509,508,509,508,509,509,508,509,509,509,509,509,509,509,510,509,510,509,510,509,510,509,513,509,509,508,509,509,509,510,509,511,509,508,509,508,508,511,508,510,509,506,510,509,509,509,509,510,509,510,509,510,509,510,509,510,509,512,508,511,508,509,508,509,510,509,510,509,509,509,509,509,508,509,508,508];%508];

%CONCLUSIONS: the revised parameters (c1,c2,c3,c4 that are purely mathematical)
%from test5 revision of the code were used on the data got from first PFT lab 
%testing. Overall, it decreased values (and thus decreased accuracy) of 
%fast injections, but increased the FEV value (and thus increased accuracy)
%of the slow injection. While less values were digitally conditioned out,
%one multipicative constant was decreased, creating a trade off of overall
%precision versus high fast-pace, injection accuracy.
%
%c1 should be correct and c2 should not change, but more research on c3
%(and more specifically the real sample time) should be done. c4 may be
%critical since a way of finding the distribution of zero-flow static
%autonously should be considered.

%-----------Compare with data in in test3-----------
% SLOW. Original = 2.92071. New simp = 2.8823. New ebel int = 2.8746
%readVal = [509,515,515,516,516,517,517,518,518,519,519,519,519,519,519,518,519,519,518,519,519,518,518,518,518,518,518,517,517,518,517,517,516,516,516,516,516,516,516,516,516,516,516,516,516,516,516,516,515,515,514,515,515,515,515,515,515,515,515,514,514,514,515,514,514,517,513,514,514,514,514,514,513,513,513,513,513,513,513,513,513,513,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,511,512,512,512,512,513,512,512,512,512,512,512,512,512,512,512,512,512,512,511,512,511,511,512,511,511,512,512,512,512,511,511,512,511,512,512,512,511,511,512,511,511,512,511,511,511,511,511,510,511,511,511,511,511,511,511,511,511,511,511,510,510,510,510,511,510,510,510,510,510,510,510,510,511,511,510,511,511,511,511,511,511,511,511,511,511,511,511,511,511,511,511,511,511,511,510,511,511,511,511,511,511,511,511,511,511,511,511,511,511,511,510,511,511,511,511,511,511,511,511,510,511,511,511,511,511,511,511,510,511,511,510,511,511,511,511,511,511,510,511,510,510,510,510,511,510,510,510,511,510,510,510,510,510,510,510,510,511,510,510,511,511,510,510,511,511,511,511,510,511,511,511,511,511,511,511,511,511,511,511,511,511,511,510,511,511,510,510,511,510,510,510,510,510,510,509,509,509,510,510,510,510,509,509,509,510,510,510,510,509,509,510,510,510,510,510,510,510,510,510,511,510,511,510,510,510,510,510,510,510,510,510,510,510,510,510,510,510,510,510,510,510,510,510,510,510,509,509,509,510,510,510,510,509,510,510,510,510,510,510,510,510,511,511,510,511,510,511,511,511,511,511,511,511,511,511,511,511,510,511,511,511,511,511,511,511,511,511,511,511,512,511,510,510,510,510,510,510,510,510,511,510,511,511,511,511,511,511,511,511,511,511,511,512,511,511,511,511,511,511,511,511,511,511,511,511,511,511,511,510,511,511,511,511,511,511,511,511,511,511,512,511,511,511,511,511,511,511,511,511,511,510,510,511,511,510,510,511,510,510,510,510,510,510,510,510,510,510,511,510,510,510,510,510,510,511,511,510,511,510,510,510,510,511,511,511,510,510,510,510,511,511,511,511,510,511,510,510,510,510,511,511,511,511,511,511,511,511,511,511,511,511,511,512,511,511,511,511,511,512,511,512,512,512,512,512,512,513,513,498,502,514,516,514,507,506,510,512,513,509,509,508,510,511,509,509,509,509,509,510,510,509,509,509,509,510,510,510,509,510,509,510,509,509,510,509,509,510,510,509,509,510,509,510,510,509,509,509,509,509,509,509,509,509,509,509,510,510,509,509,509,509,509,510,509,509,509,509,509,509,509,509,509,509,509,509,509,509,509,509,509,509,509,509,510,509,510,510,509,509,509,510,509,509,509,510,509,509,509,509,509,510,509,510,509,509,509,509,509,509,509,509,509,509,509,509,509,509,509,510,509,509,509,509,509,509,509,509,509,509,510,509,509,509,510,509,509,509,509,509,509,509,509,509,509,509,509,509,509,509,510,510,510,510,510,510,509,510,510,509,510,509,510,509,509,509,509,510,510,509,509,510,510,510,509,511,509,509,509,509,509,509,509,509,509,509,509,510,509,509,510,509,509,509,509,509,509,509,509,510,509,509,509,510,510,510];%,509];
%
% SLOW 5.6 seconds. Orginal = 2.76626; New Simp = 2.7296. New ebel Int = 2.7406
%readVal = [509,514,515,515,516,517,518,518,519,519,519,519,520,520,520,520,520,520,520,521,521,521,522,521,521,520,520,519,518,517,517,516,516,515,515,514,514,514,513,514,512,512,512,512,511,512,512,512,511,512,512,512,512,512,512,512,511,512,512,512,512,512,512,512,513,513,513,513,513,513,513,513,513,512,512,512,512,512,512,512,512,512,511,511,512,512,511,511,511,511,511,512,512,512,512,512,512,512,512,512,512,512,512,512,511,512,511,511,511,511,511,511,511,510,511,511,511,510,511,511,510,510,510,510,511,510,510,510,510,510,510,511,510,510,510,510,510,510,510,510,510,510,510,510,510,510,510,510,510,510,512,510,510,511,511,511,510,510,511,510,511,510,511,511,511,510,510,510,511,510,511,510,511,511,511,511,510,510,510,510,510,511,510,510,510,511,510,511,510,510,510,510,510,510,510,510,512,510,510,510,510,510,509,510,509,510,510,510,511,510,510,510,510,510,510,510,510,510,510,510,510,510,511,510,511,510,510,510,509,509,510,509,509,509,510,510,510,509,510,510,510,510,509,510,509,510,509,509,509,509,509,510,510,510,510,510,509,510,509,509,510,510,510,510,511,510,510,510,511,510,510,511,510,511,510,510,511,511,511,511,511,511,510,510,510,510,510,511,510,510,510,511,511,510,511,510,511,510,510,510,510,510,510,510,510,510,510,511,510,510,511,511,511,511,511,511,511,511,511,511,511,511,511,511,511,511,511,511,511,511,511,511,511,512,511,510,511,511,510,511,511,511,511,511,511,511,511,511,511,511,511,511,511,511,510,512,511,511,511,511,511,511,511,511,511,511,511,511,510,511,510,511,512,511,511,510,510,511,511,511,511,511,511,511,511,511,511,511,511,512,511,511,511,511,511,511,511,511,511,511,511,511,511,511,511,510,513,510,511,511,511,511,512,511,511,511,511,511,511,511,511,511,511,511,511,511,511,511,512,512,511,512,512,512,511,511,511,511,511,511,511,512,511,511,512,511,511,511,511,511,511,511,511,510,511,511,511,511,510,510,511,510,510,510,510,510,511,510,511,510,511,510,511,510,510,511,510,511,510,510,510,510,510,510,510,511,510,510,511,511,510,511,511,510,510,510,511,510,512,511,510,511,510,510,510,510,510,510,510,510,510,510,510,510,511,510,511,510,509,510,510,510,509,509,509,509,510,509,510,510,510,510,510,510,510,510,510,511,510,511,510,510,510,510,510,511,510,510,510,510,510,510,510,510,510,510,510,511,511,510,510,510,511,510,510,510,510,510,510,510,510,510,510,510,511,511,510,510,510,510,510,510,510,510,510,510,511,510,511,510,510,510,510,510,510,510,510,510,510,510,510,511,510,510,510,510,510,510,510,510,510,510,511,510,510,510,510,510,510,510,510,510,510,510,510,510,510,511,510,510,510,510,510,510,510,510,510,510,510,510,510,510,510,510,510,510,510,510,510,510,510,510,510,510,510,510,510,510,510,510,510,510,510,510,510,510,511,510,510,510,510,510,510,511,510,510,511,511,510,511,511,511,511,511,510,510,511,511,511,511,511,511,511,511,511,511,511,512,511,512,512,511,512,513,512,512,513,513,513,513,514,514,515,513,502,513,516,514,508,506,509,511,512,510,508,508,510,511,510,509,509,509,510,510,509,509,509];%510];

%-----------Compare rev5 with data in in test5 (should be same and they are!)-----------
% FAST. simpson's revised = 2.8702  ;original = 2.87024; ebel's int = 2.8308
%       readVal = [509,514,516,519,522,527,534,546,562,576,590,603,610,617,618,625,629,635,643,651,659,668,678,686,696,707,716,724,732,742,749,756,760,771,773,772,770,773,781,782,784,791,799,797,794,785,766,730,694,658,639,622,427,538,509,518,500,504,504,515,516,510,508,509,511,512,509,509,509,510,511,510,509,509,510,510,509,509,510,509,510,509,509,510,509,510,510,509,509,510,509,509,509,509,510,510,509,509,510,510,509,510,510,510,509,509,509,510,510,510,510,510,510,509,509,509,509,510,509,509,509,509,510,509,509,509,509,510,509,509,510,509,509,509,510,509,510,510,509,510,510,509,510,509,510,509,510,509,510,510,510,509,509,510,509,509,509,509,510,510,510,510,509,510,509,510,509,510,510,509,510,510,509,509,510,509,509,509,509,510,510,510,510,510,510,510,510,510,510,510,509,509,510,509,510,509,509,509,510,509,510,510,510,509,510,510,509,509,509,509,510,509,510,510,510,509,509,509,509,510,509,510,509,510,509,510,510,510,509,510,509,509,510,509,509,510,509,510,510,510,509,509,510,510,510,510,510,509,509,510,510,509,509,509,510,509,509,510,509,509,509,509,510,509,509,510,510,510,509,510,510,509,509,509,509,510,510,509,510,510,509,509,510,509,509,509,509,509,509,510,510,509,510,510,509,509,509,509,509,509,509,510,509,509,509,509,509,510,509,509,509,509,509,510,510,509,510,510,510,509,510,509,509,509,509,510,509,509,509,510,510,509,509,510,509,510,510,510,510,509,509,509,509,509,510,510,509,510,509,510,509,510,510,510,509,510,509,510,509,510,510,510,511,510,509,510,510,509,509,509,509,510,510,510,509,510,509,510,510,509,509,509,509,509,509,510,510,510,509,509,510,509,510,510,510,510,510,510,510,510,509,509,509,509,509,509,509,509,510,510,509,510,509,509,510,509,509,509,509,510,509,510,509,510,509,509,509,510,509,509,510,510,509,510,510,510,509,510,509,509,510,510,509,509,510,510,509,510,509,510,509,510,510,510,509,510,510,509,510,509,510,510,510,510,509,510,509,510,510,509,510,509,509,509,510,509,509,509,510,510,510,510,510,509,510,509,509,509,510,510,510,510,509,510,510,510,509,509,509,510,510,510,509,510,509,509,509,509,509,509,509,509,509,510,509,510,510,509,510,509,509,510,510,510,510,510,510,510,510,509,509,509,510,510,510,509,509,509,510,509,510,509,509,510,509,510,509,509,509,510,509,509,509,509,509,509,509,509,510,510,509,510,509,509,509,510,509,509,510,510,509,509,509,509,509,509,509,510,509,509,509,509,509,509,510,509,510,509,509,509,509,509,510,510,509,509,510,509,510,509,510,510,510,510,509,510,510,509,510,509,509,509,510,511,509,509,509,509,509,509,510,510,510,510,509,510,509,509,509,509,509,510,509,510,509,510,510,510,510,509,509,510,509,509,509,510,510,510,510,509,510,510,510,509,510,509,510,509,509,510,509,509,509,510,509,509,509,509,510,509,509,509,509,509,509,509,509,509,509,509,509,510,509,510,509,510,509,509,509,509,509,509,510,509,510,509,509,509,510,509,509,510,509,509,510,510,510,510,509,509,510,509,509,510,510,510,510,509,510,509,510,509,509,509,509,510,509,510,509,510,509,509,510,510,510,510,509];%509];
% slow - 3.73 sec. simppson's Rev = 3.4415; orig = 3.44156; ebel int = 3.4369
%        readVal = [509,515,515,516,516,516,517,517,518,518,517,517,517,517,517,516,516,516,515,516,515,515,516,515,516,515,515,515,515,515,515,515,515,515,514,514,514,514,514,514,514,514,513,514,514,514,514,513,514,514,514,514,514,514,514,514,515,515,515,515,515,515,515,514,515,515,515,515,515,515,514,514,514,514,513,513,514,513,513,513,513,512,512,512,512,512,512,512,513,512,512,512,512,512,512,512,512,512,512,512,512,513,513,513,513,513,513,513,513,513,513,513,513,513,513,513,515,514,513,514,513,513,513,513,513,513,513,512,512,512,512,512,512,513,512,513,512,512,512,512,512,512,511,512,511,511,512,511,512,512,512,513,512,512,512,512,512,512,512,512,512,512,513,513,513,513,513,513,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,513,512,511,511,511,511,511,511,511,511,511,511,511,511,511,511,511,512,511,512,511,511,511,511,511,512,512,511,511,511,511,512,511,512,511,511,511,511,511,511,511,511,511,511,511,511,512,511,511,511,511,511,512,512,511,512,511,511,512,512,512,512,512,511,511,512,511,512,511,512,511,512,511,511,512,512,512,511,511,511,511,512,511,511,511,511,511,511,511,511,511,512,511,512,512,512,511,512,511,512,512,512,512,511,511,511,511,512,511,511,511,512,511,512,512,512,512,511,511,512,512,512,512,512,512,512,511,512,511,512,511,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,511,512,512,512,512,511,511,511,512,512,511,511,511,511,511,511,511,512,511,512,511,512,511,511,511,511,512,512,512,512,512,512,512,512,512,511,512,513,512,512,512,512,512,512,512,511,512,511,512,512,511,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,511,512,512,512,512,512,513,513,513,513,514,514,514,520,510,502,511,514,513,508,507,508,511,511,510,509,509,510,510,510,509,509,509,510,510,510,509,510,510,509,510,510,509,510,509,509,510,510,510,509,510,509,509,509,510,510,509,510,509,509,509,509,509,510,510,510,510,509,510,509,509,509,509,509,510,509,510,509,510,510,509,510,510,510,510,509,510,509,510,509,510,509,509,510,510,510,509,509,510,510,509,509,510,509,509,509,510,509,510,509,510,510,510,509,509,510,510,509,509,510,509,510,510,510,509,509,508,510,510,510,509,510,509,509,510,509,509,509,510,510,509,509,509,509,509,509,509,509,509,509,509,510,509,509,509,510,510,509,509,510,509,509,510,509,509,509,509,510,510,510,510,509,510,510,509,510,510,510,510,509,510,508,509,510,510,510,509,509,509,509,509,510,510,509,509,509,510,509,510,509,510,510,510,509,510,509,509,509,509,509,509,509,509,509,509,509,509,509,511,509,509,509,510,509,510,510,509,510,510,510,509,510,510,509,509,509,510,509,510,509,509,510,510,509,510,510,510,509,509,509,510,510,509,510,510,510,510,509,510,510,509,509,509,509,509,510,509,509,510,510,510,510,510,510,510,510,509,509,509,510,509,510,510,510,510,509,510,509,510,509,510,509,510,509,510,509,509,510,510,509,510,510,509,510,510,510,510,509,510,509,510,509,510,509,510,510,510,509,509,509,509,509,510,509,510,510,509,509,510];%,510];
%       - this data posses HUGE positively skewed spike, which may account for
%           overestimate.
% CONCLUSIONS: The calculations in MATLAB are the correct translation of the
% FW in the Arduino code.
%-------------------------------------------
% Questions
%
% 1. How and why do the abrupt, temporary drop spikes in the test3, 5.6 sec
% data occur? Should I filter them out? Is it possible for humans to
% generate such a spike? Are they the reason my calculations aren't
% overestimating the FEV6?
%
% 2. Is the first slow data of test3 creating not being overestimated
% because there many drops from 511 to 510 when the injection has clearly
% not finished?
%
% 3. How is the overestimation on slow test5 data possible?? After the end
% of the injection, the values remain within 509,510 for the most part and
% there are no significant random spikes in the data beforehand.

%---------- Ortega Meeting Prep---------------
readVal = [509,515,517,519,521,524,526,529,535,542,551,560,570,582,591,599,609,615,623,631,642,650,658,667,679,685,691,694,696,695,696,697,701,704,708,709,710,711,710,712,710,716,719,714,711,709,706,703,698,691,697,697,697,690,683,685,618,492,551,532,529,515,506,504,512,511,509,508,509,509,511,510,508,509,509,510,509,509,509,509,510,510,509,508,509,509,509,509,509,509,509,509,509,509,509,509,509,509,509,509,509,509,509,509,509,509,509,509,509,509,509,509,509,509,510,509,509,509,509,509,508,509,510,509,509,509,509,509,509,509,509,509,509,509,509,509,510,509,509,509,509,509,509,509,509,509,509,509,509,509,509,509,509,509,509,510,509,508,509,509,510,509,509,510,509,509,509,509,510,509,509,510,509,509,509,509,509,509,509,509,509,509,509,509,509,509,509,509,509,509,509,509,510,509,509,509,509,509,509,509,509,509,509,509,509,509,509,509,509,509,509,510,509,510,509,509,509,509,509,509,509,509,509,509,509,509,509,509,509,509,509,509,509,509,509,509,510,509,510,509,509,509,509,509,509,510,509,509,510,509,510,509,509,509,509,509,509,509,509,509,509,509,509,509,509,509,509,509,509,509,509,509,510,509,509,510,509,509,509,509,509,509,509,510,509,509,509,509,509,509,509,509,509,509,509,509,509,509,509,509,509,508,509,510,509,509,510,509,509,509,509,509,510,509,509,509,509,509,509,509,509,509,509,509,509,509,509,509,509,509,509,509,509,509,509,509,509,509,510,509,509,509,509,509,509,509,509,509,509,509,509,509,509,509,509,509,509,509,509,509,510,509,509,509,510,510,509,510,510,509,509,510,509,509,509,509,510,509,509,510,510,510,509,509,509,510,509,509,509,510,510,509,510,509,509,509,509,509,509,509,509,509,509,509,509,509,509,509,509,509,509,509,509,509,509,509,509,510,509,509,509,509,509,509,509,509,509,509,509,509,509,510,509,509,510,509,509,509,509,509,509,510,510,510,510,509,510,509,510,510,510,509,509,510,510,509,510,509,509,510,510,509,509,509,509,509,509,509,510,510,509,509,509,510,509,510,509,510,510,510,509,510,509,509,510,509,509,510,510,509,510,509,509,510,510,509,510,510,509,509,509,510,509,510,509,509,510,509,510,509,509,509,510,510,509,510,509,510,509,510,509,509,509,510,509,509,509,510,510,509,509,509,509,509,509,509,510,510,510,510,509,509,509,510,509,509,509,509,510,510,509,509,510,509,510,509,509,509,510,509,509,509,510,510,510,509,509,510,509,509,510,509,510,509,510,509,509,509,510,510,510,509,509,510,510,510,509,510,510,510,509,509,510,510,510,509,509,510,510,510,509,509,510,510,510,509,509,510,510,510,509,509,509,510,509,509,510,510,510,510,509,510,509,510,509,509,509,510,510,510,509,510,509,509,509,509,510,509,509,509,509,510,510,510,509,510,510,510,510,509,509,510,509,510,509,509,510,509,510,509,509,509,509,509,509,510,510,510,509,509,510,510,510,509,509,510,510,510,509,509,510,509,510,509,510,510,510,509,509,509,510,510,509,509,509,509,509,509,509,509,510,510,510,509,510,509,510,510,509,509,510,510,510,510,510,509,510,510,510,510,509,510,509,510,510,510,509,510,510,510,510,509,510,510,510,509,509,509,510];
L = length(readVal);
cal = readVal(1);
Ts = 8.1238;
c3 = 2.7079365079; %c3 = 2.7430 for earlier versions

FEV_even = 0;
FEV_odd = 0;
FEV_beg_end = zeros(1,4);
FEV_beg_end(1) = bitsToflow(readVal(1),cal);        %i=1
FEV_beg_end(4) = bitsToflow(readVal(L),cal);        %i=737

%CONVERT FEV
for i = 3:2:(L - 2)                                 %i=[3,5,7,...,735]
    FEVtemp = bitsToflow(readVal(i),cal);
    FEV_even = FEV_even + FEVtemp;
end
for i = 2:2:(L - 1)                                 %i=[2,6,8,...,736]
    FEVtemp = bitsToflow(readVal(i),cal);
    FEV_odd = FEV_odd + FEVtemp;
end

%SIMPSON'S 1/3 COMPOSITE INTEGRATION
FEVsimp = FEV_beg_end(1) + 4 * FEV_odd + 2 * FEV_even + FEV_beg_end(4);
FEVsimp = FEVsimp * c3;

%EBEL'S INT
x = linspace(0,L-1,L)*Ts*10^-3; %ms
FEVtemp = zeros(1,L);
for i = 1:1:L
    FEVtemp(i) = bitsToflow(readVal(i),cal);
end 
FEVint = intdef(x,FEVtemp,x(1),x(end)); %m^3
FEVint = FEVint * 1000; %1000L/m^3

%[a rsquared] = iliya_funcPolyRegression(x,readVal,3)
%fit = @(x) a(4) + a(3)*x + a(2)*x.^2 + a(1)*x.^3;
%yy = interpl(x,readVal,x,'spline');

%a = polyfit(x,FEVtemp,7);
%fit = polyval(a,x);

%PEF = max(readVal(1:round(1000/Ts)));
%RT = find(readVal == round((PEF - cal)*0.9)+readVal(1),'first' );
%DT90 = 

hold on
figure(1)
plot(x,readVal)%,x,fit)